name: üöÄ Notificar eventos a Discord

on:
  push:
  pull_request:
  issues:
  release:
  fork:
  watch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: üì¢ Enviar evento a Discord
        run: |
          EVENT_TYPE="${{ github.event_name }}"
          REPO="${{ github.repository }}"
          ACTOR="${{ github.actor }}"
          MESSAGE="${{ github.event.head_commit.message || 'Sin mensaje' }}"
          URL="${{ github.event.head_commit.url || github.event.repository.html_url }}"
          ROLE_ID="1319729041322016788"

          # Elegir emoji seg√∫n el tipo de evento
          case "$EVENT_TYPE" in
            push)        ICON="üì¶"; COLOR=3447003 ;;       # Azul
            pull_request) ICON="üîÄ"; COLOR=10181046 ;;      # Morado
            issues)      ICON="üêõ"; COLOR=15158332 ;;       # Rojo
            release)     ICON="üè∑Ô∏è"; COLOR=15844367 ;;      # Dorado
            fork)        ICON="üç¥"; COLOR=3066993 ;;        # Verde
            watch)       ICON="‚≠ê"; COLOR=16776960 ;;        # Amarillo
            *)           ICON="üì£"; COLOR=5814783 ;;        # Gris
          esac

          # Construir t√≠tulo con el emoji y nombre del repo
          TITLE="$ICON Nuevo evento en $REPO"

          # Construir el payload JSON con jq
          PAYLOAD=$(jq -n \
            --arg title "$TITLE" \
            --arg type "$EVENT_TYPE" \
            --arg actor "$ACTOR" \
            --arg message "$MESSAGE" \
            --arg url "$URL" \
            --arg role "<@&${ROLE_ID}>" \
            --argjson color $COLOR \
            '{
              content: "üîî **Notificaci√≥n autom√°tica:** \($role)",
              allowed_mentions: { parse: ["roles"] },
              embeds: [
                {
                  title: $title,
                  description: (
                    "üë§ **Autor:** " + $actor + "\n" +
                    "üß© **Evento:** " + $type + "\n" +
                    "üí¨ **Mensaje:** " + $message
                  ),
                  url: $url,
                  color: $color,
                  footer: { text: "ü§ñ GitHub Actions ‚Ä¢ Enviado autom√°ticamente" },
                  timestamp: (now | todate)
                }
              ]
            }')

          # Enviar el mensaje a Discord
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "${{ secrets.DISCORD_WEBHOOK }}"
