name: Notificar eventos a Discord

on:
  push:
  pull_request:
  issues:
  release:
  fork:
  watch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar evento a Discord
        run: |
          EVENT_TYPE="${{ github.event_name }}"
          REPO="${{ github.repository }}"
          ACTOR="${{ github.actor }}"
          MESSAGE="${{ github.event.head_commit.message }}"
          URL="${{ github.event.head_commit.url }}"

          PAYLOAD=$(jq -n \
            --arg title "ðŸ“¦ Nuevo evento en $REPO" \
            --arg type "$EVENT_TYPE" \
            --arg actor "$ACTOR" \
            --arg message "$MESSAGE" \
            --arg url "$URL" \
            --arg color "5814783" \
            '{
              embeds: [
                {
                  title: $title,
                  description: "**Tipo:** " + $type + "\n**Autor:** " + $actor + "\n**Mensaje:** " + $message,
                  url: $url,
                  color: ($color | tonumber)
                }
              ]
            }')

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               ${{ secrets.DISCORD_WEBHOOK }}
