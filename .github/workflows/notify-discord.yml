name: Notificar eventos a Discord

on:
  push:
  pull_request:
  issues:
  release:
  fork:
  watch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar evento a Discord
        run: |
          EVENT_TYPE="${{ github.event_name }}"
          REPO="${{ github.repository }}"
          ACTOR="${{ github.actor }}"
          MESSAGE="${{ github.event.head_commit.message || '' }}"
          URL="${{ github.event.head_commit.url || github.event.repository.html_url }}"
          ROLE_ID="1319729041322016788"

          # Construir el payload JSON con jq
          PAYLOAD=$(jq -n \
            --arg title "ðŸ“¦ Nuevo evento en $REPO" \
            --arg type "$EVENT_TYPE" \
            --arg actor "$ACTOR" \
            --arg message "$MESSAGE" \
            --arg url "$URL" \
            --arg role "<@&${ROLE_ID}>" \
            --argjson color 5814783 \
            '{
              content: "ðŸš¨ Nuevo evento detectado: \($role)",
              allowed_mentions: { parse: ["roles"] },
              embeds: [
                {
                  title: $title,
                  description: ("**Tipo:** " + $type + "\n**Autor:** " + $actor + "\n**Mensaje:** " + $message),
                  url: $url,
                  color: $color
                }
              ]
            }')

          # Enviar el mensaje a Discord
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "${{ secrets.DISCORD_WEBHOOK }}"
